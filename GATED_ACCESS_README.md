# ğŸ” Secret Gated Access System - Complete Documentation

Welcome to your production-ready gated access system! This guide explains how everything works and how to get started.

---

## ğŸ¯ System Overview

### What This System Does

1. **Gating**: Protects 5 websites behind email/SMS 2FA verification
2. **Tracking**: Records who attempts to visit and who actually verifies
3. **Encryption**: All visitor data encrypted at rest in Firebase
4. **Admin Panel**: Secret dashboard accessible ONLY to you (after 2FA)
5. **Data Access**: Decrypt and view all visitor information

### Protected Sites

- ğŸ¨ **Plasmic** - plasmic.html
- ğŸ® **Cubix** - cubix.html
- ğŸš€ **Fallen Futuristics** - fallen-futuristics.html
- ğŸ—ºï¸ **Atlas** - atlas.html
- ğŸŒ¸ **La Vie** - la-vie.html

### Admin Credentials

**Only these can access the secret admin panel:**

- ğŸ“§ Email: `frankalfaro105@gmail.com`
- ğŸ“§ Email: `frankalfaro105@proton.me`
- ğŸ“± Phone: `+13462821804`

---

## ğŸš€ Quick Start (5 Minutes)

### 1. Run Setup Script

**Windows:**

```bash
setup-system.bat
```

**macOS/Linux:**

```bash
chmod +x setup-system.sh
./setup-system.sh
```

This script:

- âœ… Installs Firebase CLI
- âœ… Installs Twilio CLI
- âœ… Generates encryption key
- âœ… Creates `.env` template
- âœ… Sets up dependencies

### 2. Fill in `.env` Credentials

Edit `backend/.env`:

```env
# Get these from Firebase Console
FIREBASE_PROJECT_ID=relegatedleader-54c49
FIREBASE_PRIVATE_KEY_ID=...
FIREBASE_PRIVATE_KEY=...

# Get these from Twilio Console
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=...

# Gmail app-specific password
SMTP_PASSWORD=...

# (Already generated by setup script)
ENCRYPTION_KEY=...
```

### 3. Start Backend Server

```bash
cd backend
npm start
```

Server runs on: `http://localhost:8000`

### 4. Access Admin Panel

```
http://localhost:8000/admin-secret-panel.html
```

---

## ğŸ“‹ Architecture

### User Flow (Regular Visitor)

```
1. User visits protected site (e.g., plasmic.html)
   â†“
2. Gated access modal appears
   â†“
3. User enters email or phone
   â†“
4. Backend sends 6-digit code (email or SMS)
   â†“
5. User enters code
   â†“
6. Code verified, token created (20-min expiry)
   â†“
7. User can access site for 20 minutes
   â†“
8. Data stored encrypted in Firebase
```

### Admin Flow (You!)

```
1. Go to /admin-secret-panel.html
   â†“
2. Enter your email or phone
   â†“
3. Request verification code
   â†“
4. Receive code (SMS or email)
   â†“
5. Enter code to verify
   â†“
6. System detects you're admin
   â†“
7. Secret admin panel unlocks
   â†“
8. View all decrypted visitor data
```

---

## ğŸ”§ File Structure

```
backend/
â”œâ”€â”€ server.js                 # Express app
â”œâ”€â”€ package.json              # Dependencies
â”œâ”€â”€ .env                      # Environment variables (create this)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ firebase.js           # Firebase setup
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ gated-access.js      # Main API (275+ lines)
â””â”€â”€ utils/
    â”œâ”€â”€ database.js           # Firestore operations
    â”œâ”€â”€ encryption.js         # Crypto utilities
    â””â”€â”€ emailService.js       # Email sending

frontend/
â”œâ”€â”€ gated-access.js           # Modal UI & logic
â””â”€â”€ (integrated in HTML files)

HTML Pages
â”œâ”€â”€ plasmic.html              # Protected site 1
â”œâ”€â”€ cubix.html                # Protected site 2
â”œâ”€â”€ fallen-futuristics.html   # Protected site 3
â”œâ”€â”€ atlas.html                # Protected site 4
â”œâ”€â”€ la-vie.html               # Protected site 5
â””â”€â”€ admin-secret-panel.html   # Secret admin dashboard

Documentation
â”œâ”€â”€ CLI_SETUP_GUIDE.md        # Firebase & Twilio CLI setup
â”œâ”€â”€ ENCRYPTION_KEY_SETUP.md   # How to generate encryption key
â””â”€â”€ GATED_ACCESS_README.md    # This file
```

---

## ğŸ” Security Features

### Encryption

- **Algorithm**: AES-256-CBC with random IV
- **Encrypted Fields**:
  - Visitor email/phone
  - Visitor IP address
  - Protected sites list
- **Key Storage**: `.env` file (not committed to git)
- **Backup**: Store in password manager

### Admin Authentication

- **Method**: Email or phone + 6-digit code
- **Hardcoded Credentials**: Only specific emails/phones can access
- **2FA Verification**: Code must be entered (20-minute window)
- **Session Token**: Unique token for each admin session
- **Encryption**: All endpoints return `is_admin` flag for frontend routing

### Data Protection

- âœ… Encrypted at rest in Firebase
- âœ… Only admin can decrypt and view
- âœ… Regular users cannot see admin panel
- âœ… No sensitive data in localStorage
- âœ… IP addresses logged and encrypted
- âœ… Timestamps for audit trail

---

## ğŸ“Š Admin Panel Features

### Access Logs

View all visitor attempts with:

- Contact (email/phone) - masked
- Site accessed
- IP address
- Status (verified/pending)
- Timestamp of request
- Timestamp of verification

### Search & Filter

- Search by contact, site, or IP
- Filter verified vs pending
- Filter by date range

### Data Export

- Download as CSV
- Includes all decrypted data
- For your records/analysis

### Statistics

- Total access requests
- Number of verified accesses
- Unique visitor count
- Success rate

### Protected Sites List

- View all 5 gated sites
- See which are active
- Encrypted storage

---

## ğŸ› ï¸ API Endpoints

### Public Endpoints (Anyone)

```
POST /api/gated/send-code-email
POST /api/gated/send-code-sms
POST /api/gated/verify-code
GET  /api/gated/check-session/:token/:site
```

### Admin Endpoints (Auth Required)

```
POST /api/gated/admin/access-logs
POST /api/gated/admin/get-sites
POST /api/gated/admin/stats
```

All admin endpoints require:

- `token`: Session token
- `admin_contact`: Your email/phone

---

## ğŸ”‘ Environment Variables Reference

| Variable                  | Purpose                  | Example                  |
| ------------------------- | ------------------------ | ------------------------ |
| `FIREBASE_PROJECT_ID`     | Firebase project         | `relegatedleader-54c49`  |
| `FIREBASE_PRIVATE_KEY_ID` | Firebase key ID          | From console             |
| `FIREBASE_PRIVATE_KEY`    | Firebase private key     | From console             |
| `FIREBASE_CLIENT_EMAIL`   | Firebase service account | firebase-adminsdk@...    |
| `ENCRYPTION_KEY`          | Master encryption key    | 64 hex chars             |
| `TWILIO_ACCOUNT_SID`      | Twilio account           | ACxxxx                   |
| `TWILIO_AUTH_TOKEN`       | Twilio auth              | From console             |
| `TWILIO_PHONE_NUMBER`     | Your Twilio number       | +1234567890              |
| `SMTP_USER`               | Email sender             | frankalfaro105@gmail.com |
| `SMTP_PASSWORD`           | Gmail app password       | From Gmail settings      |
| `PORT`                    | Server port              | 8000                     |
| `NODE_ENV`                | Environment              | production               |

---

## ğŸš¨ Troubleshooting

### "Encryption key not found"

```bash
# Solution: Set ENCRYPTION_KEY in backend/.env
# Generate new key:
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### "Cannot verify code"

1. Check code is entered correctly (case-sensitive)
2. Check code hasn't expired (20 minutes)
3. Check Twilio credentials in `.env`
4. Check Firebase connection works

### "Admin panel shows no data"

1. Verify you're using correct email/phone
2. Check encryption key is set
3. Check Firebase has access logs
4. Try refreshing page

### "SMS not sending"

1. Verify Twilio phone number verified
2. Check `TWILIO_PHONE_NUMBER` in `.env`
3. Verify recipient number is valid
4. Check Twilio account has credits

### "Email not sending"

1. Generate Gmail app-specific password (not regular password)
2. Set `SMTP_PASSWORD` in `.env`
3. Allow "Less secure app access" if using Gmail
4. Check `SMTP_USER` is correct

---

## ğŸ“ˆ Deployment

### Firebase Hosting

```bash
firebase deploy
```

### Google Cloud Run

```bash
gcloud run deploy gated-access --source .
```

### Vercel

```bash
vercel deploy
```

### Traditional VPS

```bash
# Build
npm run build

# Start
npm start

# Keep running with PM2
pm2 start npm --name "gated-access" -- start
```

---

## ğŸ“š Complete Setup Guide

For detailed step-by-step instructions:

1. **CLI Setup**: See [CLI_SETUP_GUIDE.md](CLI_SETUP_GUIDE.md)
   - Firebase CLI configuration
   - Twilio CLI setup
   - Security rules

2. **Encryption Key**: See [ENCRYPTION_KEY_SETUP.md](ENCRYPTION_KEY_SETUP.md)
   - How to generate
   - Where to store
   - How to backup

3. **Firebase Console**:
   - Project: [relegatedleader-54c49](https://console.firebase.google.com/?projectId=relegatedleader-54c49)
   - Get service account credentials
   - Enable Firestore
   - Set security rules

4. **Twilio Console**:
   - Get Account SID and Auth Token
   - Verify phone numbers for testing
   - Set up messaging service

---

## ğŸ”„ Maintenance

### Regular Tasks

- âœ… Monitor access logs weekly
- âœ… Check Firebase quota usage
- âœ… Review admin panel stats
- âœ… Backup encryption key monthly
- âœ… Update dependencies: `npm update`

### Database Cleanup

```bash
# View Firestore usage
firebase firestore:delete [collection-name]

# Export data
firebase firestore:export gs://bucket-name/
```

### Logs & Monitoring

- Firebase: `firebase functions:log`
- Server: Check console output
- Admin Panel: Review access logs

---

## ğŸ’¡ Tips & Tricks

### Access Code Debugging

If code won't verify:

1. Check Firebase for `access_codes` collection
2. Verify code hasn't expired
3. Check contact field matches exactly
4. Ensure `.env` ENCRYPTION_KEY is set

### Testing Admin Panel

1. Use your phone number: `+13462821804`
2. Request code via SMS
3. Enter code immediately
4. Should see secret panel

### CSV Export

Use for analysis in Excel/Google Sheets:

- Time series analysis
- Visitor demographics
- Verification success rate
- Popular sites

---

## âš ï¸ Important Security Notes

âœ… **DO**:

- Store `.env` in `.gitignore`
- Regenerate encryption key if compromised
- Use strong Firebase security rules
- Enable 2FA on Firebase and Twilio accounts
- Monitor admin panel access logs
- Backup encryption key securely

âŒ **DON'T**:

- Commit `.env` to GitHub
- Share encryption key via email
- Hardcode credentials in code
- Use weak encryption key
- Leave admin panel URL publicly documented
- Store decrypted data in plain text

---

## ğŸ“ Support Resources

- [Firebase Documentation](https://firebase.google.com/docs)
- [Twilio Documentation](https://www.twilio.com/docs)
- [Node.js Documentation](https://nodejs.org/docs)
- [Express.js Guide](https://expressjs.com)

---

## ğŸ“„ License

This gating system is proprietary. All rights reserved.

---

## âœ… Verification Checklist

Before going live:

- [ ] Setup script completed successfully
- [ ] `.env` file created with all credentials
- [ ] Firebase CLI authenticated
- [ ] Twilio CLI authenticated
- [ ] Encryption key generated (64 hex chars)
- [ ] Backend server starts without errors
- [ ] Can request code via email
- [ ] Can request code via SMS
- [ ] Can verify code and access site
- [ ] Admin panel accessible
- [ ] Can decrypt and view logs
- [ ] CSV export works
- [ ] `.env` is in `.gitignore`
- [ ] All secrets are kept private

---

**System Status**: âœ… Production Ready
**Last Updated**: 2024
**Version**: 1.0.0

ğŸ” Your gated access system is now ready to protect your sites!
